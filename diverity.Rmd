---
title: "Diversity"
output: html_document
---

```{r setup, include=FALSE}
library(pacman)
p_load(ggplot,tidyverse,stringr)
files <- list.files("results2/rawdata/")
files <- files[10:18]
df<- read.csv(paste("results2/rawdata/", files[1], sep=""))

total <- as.data.frame(matrix(0,ncol=4,nrow=1))
colnames(total) <- c(colnames(df), "filename")
for(file in files){
  df<- read.csv(paste("results2/rawdata/", file, sep=""))
  df$filename <- file
  total <- rbind(total,df)
}
total <- total[-1,]
total$kaiscore <- str_remove((str_extract(total$filename, "[:digit:].*")), ".csv")
total$AllScores <- as.numeric(total$AllScores)
total$AllAiScores <- as.factor(total$AllAiScores)
total$kaiscore <- as.factor(total$kaiscore)

total$kaiscore<- str_sub(total$kaiscore, 2)
```


```{r}
library(ggplot2)
all_of_them <- total
total <- total %>% 
  group_by(kaiscore,AllAiScores) %>% 
  mutate(mean_score = mean(AllScores),
         sd_score = sd(AllScores),
         max_score = max(AllScores),
         mean_kaiscore = mean_KAI(kaiscore_numeric,aiRange,33 ) )



total$aiRange <- as.numeric(as.character(total$AllAiScores))
total$kaiscore_numeric <- as.numeric(as.character(total$kaiscore))
total <- rbind(total, all_of_them)
total$kaiscore <- as.factor(total$kaiscore)
levels(as.factor(total$mean_kaiscore))
for(level in levels(total$kaiscore)){
  a <- ggplot(total[total$kaiscore == level,], aes(AllAiScores, AllScores, group = AllAiScores)) +
    geom_point()+   
    stat_summary(fun.y = mean, colour="blue", geom="line", aes(group=1))+
    geom_point(total[total$kaiscore == level,],mapping= aes(AllAiScores,mean_score, color = "red"))+
    geom_errorbar(aes(ymin=mean_score-sd_score, ymax=mean_score+sd_score), width=.2,
                 position=position_dodge(0.05),color="red", alpha = .5)+
    ggtitle(paste("mean Kaiscore = ", as.character(level), sep = " "))+
    xlab("KaiRange")+ylab("Car Design Performance")
  
  print(a)
}



ggplot(total, aes(AllAiScores, AllScores)) +geom_point()+ 
  geom_point(total,mapping= aes(AllAiScores,mean_score, color = "red"))+
  facet_wrap(.~kaiscore)

levels(total$kaiscore)
total$kaiscore <- relevel(total$kaiscore, "45")
c("45","57","70","82","95","107","120","132","145")
plot
which(total$AllScores==max(total$AllScores))
p_load(dplyr)
total %>% group_by(
  kaiscore,AllAiScores) %>% 
  summarise(sd = sd(AllScores))

total[263,]


mean_KAI <- function(aiScore, aiRange, nAgents){
  minScore = max(c(40, aiScore-aiRange/2.0))
  maxScore = min(c(150, aiScore+aiRange/2.0))
  aiScores = seq(minScore,maxScore,length.out =  nAgents)
  m <- mean(aiScores)
  return(m)
}
mean_KAI(107,0,33)

aiScore =45
aiRange=80

minScore = max(c(40, aiScore-aiRange/2.0))
maxScore = min(c(150, aiScore+aiRange/2.0))
aiScores = seq(minScore,maxScore,length.out =  33)

mean(aiScores)
```

